package com.orobator.android.gramophone.view;import android.app.Notification;import android.app.NotificationManager;import android.app.PendingIntent;import android.app.TaskStackBuilder;import android.content.Context;import android.content.Intent;import android.graphics.Bitmap;import android.support.v4.app.NotificationCompat;import android.widget.RemoteViews;import com.orobator.android.gramophone.R;import com.orobator.android.gramophone.controller.services.MusicPlayerService;import com.orobator.android.gramophone.model.Song;import com.orobator.android.gramophone.model.SongQueue;import com.orobator.android.gramophone.view.activities.NowPlayingActivity;/** * Class used for accessing notification IDs */public class NotificationBuilder {    private static final String TAG = "NotificationBuilder";    public static final int NOW_PLAYING = 0;    private NotificationBuilder() {    }    public static void createNotification(Context context, int notificationId, boolean isPlaying) {        Song song = SongQueue.getSong(SongQueue.getCurrentSongQueuePosition());        Intent nowPlayingIntent = new Intent(context, NowPlayingActivity.class);        TaskStackBuilder stackBuilder = TaskStackBuilder.create(context);        // Adds the back stack        stackBuilder.addParentStack(NowPlayingActivity.class);        //Adds the intent to the top of the stack        stackBuilder.addNextIntent(nowPlayingIntent);        // Gets a PendingIntent containing the entire back stack        PendingIntent nowPlayingPendingIntent = stackBuilder.getPendingIntent(0, PendingIntent.FLAG_UPDATE_CURRENT);        RemoteViews smallRemoteViews = new RemoteViews(context.getPackageName(), R.layout.notification_now_playing_small);        smallRemoteViews.setCharSequence(R.id.title_TextView, "setText", song.getTitle());        smallRemoteViews.setCharSequence(R.id.artist_TextView, "setText", song.getArtist());        Bitmap albumCover = song.getSmallArtwork(context, false);        smallRemoteViews.setBitmap(R.id.albumArt_ImageView, "setImageBitmap", albumCover);        Intent togglePlaybackIntent = new Intent(context.getApplicationContext(), MusicPlayerService.class);        togglePlaybackIntent.setAction(MusicPlayerService.ACTION_TOGGLE_PLAYBACK);        PendingIntent togglePlaybackPendingIntent = PendingIntent.getService(context, 0, togglePlaybackIntent, PendingIntent.FLAG_UPDATE_CURRENT);        smallRemoteViews.setOnClickPendingIntent(R.id.togglePlayback_imageButton, togglePlaybackPendingIntent);        Intent stopPlaybackIntent = new Intent(context.getApplicationContext(), MusicPlayerService.class);        stopPlaybackIntent.setAction(MusicPlayerService.ACTION_STOP);        PendingIntent stopPlaybackPendingIntent = PendingIntent.getService(context, 0, stopPlaybackIntent, PendingIntent.FLAG_UPDATE_CURRENT);        smallRemoteViews.setOnClickPendingIntent(R.id.closeNotification_imageButton, stopPlaybackPendingIntent);        Intent nextSongIntent = new Intent(context.getApplicationContext(), MusicPlayerService.class);        nextSongIntent.setAction(MusicPlayerService.ACTION_NEXT);        PendingIntent nextSongPendingIntent = PendingIntent.getService(context.getApplicationContext(), 0, nextSongIntent, PendingIntent.FLAG_UPDATE_CURRENT);        smallRemoteViews.setOnClickPendingIntent(R.id.nextSong_imageButton, nextSongPendingIntent);        RemoteViews bigRemoteViews = new RemoteViews(context.getPackageName(), R.layout.notification_now_playing_expanded);        bigRemoteViews.setCharSequence(R.id.title_TextView, "setText", song.getTitle());        bigRemoteViews.setCharSequence(R.id.artistAlbum_TextView, "setText", song.getArtist() + " - " + song.getAlbum());        Song nextSong = SongQueue.getSong(SongQueue.getCurrentSongQueuePosition() + 1);        String upNext;        if (nextSong == null) {            String nothingInQ = context.getString(R.string.nothing_up_next);            upNext = context.getString(R.string.up_next, nothingInQ);        } else {            upNext = context.getString(R.string.up_next, nextSong.toString());        }        bigRemoteViews.setCharSequence(R.id.upNext_TextView, "setText", upNext);        Bitmap bigAlbumArt = song.getSmallArtwork(context, true);        bigRemoteViews.setBitmap(R.id.albumArt_ImageView, "setImageBitmap", bigAlbumArt);        Intent prevSongIntent = new Intent(context, MusicPlayerService.class);        prevSongIntent.setAction(MusicPlayerService.ACTION_PREV);        PendingIntent prevSongPendingIntent = PendingIntent.getService(context, 0, prevSongIntent, PendingIntent.FLAG_UPDATE_CURRENT);        bigRemoteViews.setOnClickPendingIntent(R.id.prevSong_ImageButton, prevSongPendingIntent);        bigRemoteViews.setOnClickPendingIntent(R.id.togglePlayback_imageButton, togglePlaybackPendingIntent);        bigRemoteViews.setOnClickPendingIntent(R.id.nextSong_imageButton, nextSongPendingIntent);        bigRemoteViews.setOnClickPendingIntent(R.id.closeNotification_imageButton, stopPlaybackPendingIntent);        if (isPlaying) {            smallRemoteViews.setInt(R.id.togglePlayback_imageButton, "setImageResource", R.drawable.ic_action_pause);            bigRemoteViews.setInt(R.id.togglePlayback_imageButton, "setImageResource", R.drawable.ic_action_pause);        } else {            smallRemoteViews.setInt(R.id.togglePlayback_imageButton, "setImageResource", R.drawable.ic_action_play_holo_dark);            bigRemoteViews.setInt(R.id.togglePlayback_imageButton, "setImageResource", R.drawable.ic_action_play_holo_dark);        }        NotificationCompat.Builder builder = new NotificationCompat.Builder(context)                .setSmallIcon(R.drawable.ic_launcher) // TODO: Should not be in color                .setContentIntent(nowPlayingPendingIntent)                .setOngoing(true)                .setContent(smallRemoteViews);        NotificationManager notificationManager = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);//        NotificationManagerCompat notificationManager = NotificationManagerCompat.from(context);        // Builds the notification and issues it.        Notification notification = builder.build();        notification.bigContentView = bigRemoteViews;        notificationManager.notify(notificationId, notification);    }}